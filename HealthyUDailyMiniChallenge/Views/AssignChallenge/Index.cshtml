@*@model HeathyUDailyMiniChallenge.Models.ChallengeUser
*@

@{
    ViewBag.Title = "Index";
}

<script src="~/Scripts/resources.js"></script>
<script src="~/Scripts/knockout-2.2.0.js"></script>
@*<script src="~/Scripts/app.js"></script>*@
<div class="challenges">
    <h2>Available Challenges: </h2>
    <select class="selectAvailable" data-bind="options: challenges, optionsText: 'challengeDescription', selectedOptions: temporaryChosenChallenges" multiple= "true"></select>
    <input class="chooseButton" type="button" value="Choose Challenges >>" data-bind="click: sendToChosen" />
    <select class="chosen" data-bind="foreach:chosenChallenges" multiple="true">
        <option data-bind="text: $data.challengeDescription"></option>
    </select>
</div>

<h2>Available Users: </h2>
<select data-bind="options: challengeUsers, optionsText: 'name'" multiple= "true"></select>

<script type="text/javascript">
    var challengeUsers;
    var challenges;
    var temporaryChosen;
    var chosenChallenges;
    var challengesResource = new Resource('/Api/Challenge');
    var gettingChallenges = challengesResource.get();
    var challengeUsersResource = new Resource('/Api/ChallengeUsers');
    var gettingChallengeUsers = challengeUsersResource.get();


    gettingChallenges.done(function (challengesFromServer) { challenges = challengesFromServer; });
 
    gettingChallengeUsers.done(function (challengeUsersFromServer) { challengeUsers = challengeUsersFromServer; });

    $.when(gettingChallenges, gettingChallengeUsers).done(readyToRock);

    function sendToChosen() {
        var challengesTemp = this.temporaryChosenChallenges();
        for(i=0; i<challengesTemp.length; i++)
        {
            var challengei = challengesTemp[i];
            this.chosenChallenges.push({"challengeDescription": challengei.challengeDescription});
            this.challenges.remove(challengei);
        }
    }

    function readyToRock() {
        Window.viewModel = new ViewModel();
        ko.applyBindings(Window.viewModel);
    }
    
    function ViewModel() {
        var that = this;
        this.temporaryChosenChallenges = ko.observableArray([]);
        this.challengeUsers = ko.observableArray(challengeUsers);
        this.chosenChallengeUsers = ko.observableArray([""]);
        this.challenges = ko.observableArray(challenges);
        this.chosenChallenges = ko.observableArray([]);
    }
</script>

